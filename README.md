# LINE Stamp Maker

LINE ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è‡ªå‹•ä½œæˆã™ã‚‹ Python CLI ãƒ„ãƒ¼ãƒ«ã€‚é¡”æ¤œå‡ºã€äººç‰©ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ã«ã‚ˆã‚Šã€å†™çœŸã‹ã‚‰é«˜å“è³ªãªã‚¹ã‚¿ãƒ³ãƒ—ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

## ç‰¹å¾´

- ğŸ¨ **é¡”æ¤œå‡ºã¨ã‚¯ãƒ­ãƒƒãƒ—**: é¡”ã‚’è‡ªå‹•æ¤œå‡ºã—ã¦æœ€é©ã«é…ç½®
- ğŸ­ **äººç‰©ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**: MediaPipe ã§èƒŒæ™¯ã‚’é€æ˜åŒ–
- âœ‚ï¸ **ç™½ãµã¡å–ã‚Š**: æ¨™æº– 8px ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªç™½æ 
- ğŸŒ‘ **å½±ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ**: è–„ã„å½±ã§å¥¥è¡Œãè¡¨ç¾ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- ğŸ“ **ãƒ†ã‚­ã‚¹ãƒˆæç”»**: 2 è¡Œã¾ã§ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸‹éƒ¨ã«å¸¯å›²ã„ã§ç„¼ãè¾¼ã¿
- ğŸ“¦ **è‡ªå‹•ZIPç”Ÿæˆ**: LINE Creators Market ç”¨ã® upload.zip ã‚’è‡ªå‹•ä½œæˆ
- ğŸ”„ **EXIF å›è»¢è£œæ­£**: è‡ªå‹•çš„ã«æ­£ã—ã„å‘ãã«å›è»¢

## ä»•æ§˜

### å‡ºåŠ›ç”»åƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

| ç¨®é¡ | ã‚µã‚¤ã‚º | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ | ç”¨é€” |
|------|--------|----------|------|
| Sticker | æœ€å¤§ 370x320 | PNG é€é | ãƒ¡ã‚¤ãƒ³ç”»åƒ |
| Main | 240x240 | PNG é€é | ã‚¹ãƒˆã‚¢è¡¨ç¤º |
| Tab | 96x74 | PNG é€é | ã‚¿ãƒ–ã‚¢ã‚¤ã‚³ãƒ³ |

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
line-stamp-maker/
â”œâ”€â”€ photos/              # å…¥åŠ›ç”»åƒãƒ•ã‚©ãƒ«ãƒ€
â”‚   â”œâ”€â”€ photo1.jpg
â”‚   â”œâ”€â”€ photo2.jpg
â”‚   â””â”€â”€ ...
â”œâ”€â”€ mapping.csv         # ãƒ•ã‚¡ã‚¤ãƒ«åã¨ãƒ†ã‚­ã‚¹ãƒˆã®å¯¾å¿œ
â”œâ”€â”€ out/               # å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€
â”‚   â”œâ”€â”€ stickers/
â”‚   â”‚   â”œâ”€â”€ 01.png
â”‚   â”‚   â”œâ”€â”€ 02.png
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ main_01.png
â”‚   â”œâ”€â”€ main_02.png
â”‚   â”œâ”€â”€ tab_01.png
â”‚   â”œâ”€â”€ tab_02.png
â”‚   â”œâ”€â”€ upload.zip     # LINE Creators Market ç”¨
â”‚   â””â”€â”€ results.json
â””â”€â”€ requirements.txt
```

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### å‰ææ¡ä»¶

- Python 3.11 ä»¥ä¸Š
- pip

### åŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
cd line-stamp-maker

# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt
```

### HEIC/HEIF å½¢å¼ã‚µãƒãƒ¼ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

iPhone ãªã©ã§æ’®å½±ã—ãŸ HEIC/HEIF å½¢å¼ã®ç”»åƒã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹å ´åˆï¼š

```bash
# pyproject.toml ã‚’ä½¿ã†å ´åˆï¼ˆæ¨å¥¨ï¼‰
pip install -e ".[heic]"

# ã¾ãŸã¯æ‰‹å‹•ã§
pip install pillow-heif>=0.16.0
```

HEIC/HEIF ã‚µãƒãƒ¼ãƒˆãªã—ã§å®Ÿè¡Œã—ãŸã„å ´åˆã¯ã€ä¸Šè¨˜ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ JPG/PNG å½¢å¼ã®ç”»åƒã®ã¿ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ç”¨

```bash
python -m line_stamp_maker process \
  --photos photos \
  --mapping mapping.csv \
  --output out
```

### mapping.csv ã®å½¢å¼

```csv
filename,text
photo1.jpg,ã“ã‚“ã«ã¡ã¯
photo2.jpg,å…ƒæ°—ã§ã™ã‹ï¼Ÿ
photo3.jpg,Line1
Line2
```

- `filename`: photos/ ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«å
- `text`: ã‚¹ã‚¿ãƒ³ãƒ—ã«æç”»ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæœ€å¤§ 2 è¡Œã€æ”¹è¡Œã§åŒºåˆ‡ã‚‹ï¼‰

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```bash
python -m line_stamp_maker process [OPTIONS]

Options:
  --photos PATH, -p PATH          å…¥åŠ›ç”»åƒãƒ•ã‚©ãƒ«ãƒ€ [default: photos]
  --mapping PATH, -m PATH         ãƒãƒƒãƒ”ãƒ³ã‚° CSV ãƒ•ã‚¡ã‚¤ãƒ« [default: mapping.csv]
  --output PATH, -o PATH          å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ [default: out]
  --sticker-width INTEGER         ã‚¹ãƒ†ãƒƒã‚«ãƒ¼æœ€å¤§å¹… [default: 370]
  --sticker-height INTEGER        ã‚¹ãƒ†ãƒƒã‚«ãƒ¼æœ€å¤§é«˜ã• [default: 320]
  --border INTEGER, -b INTEGER    ç™½ãµã¡å¹…ï¼ˆãƒ”ã‚¯ã‚»ãƒ«ï¼‰ [default: 8]
  --font-size INTEGER, -f INT     ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º [default: 24]
  --no-segmentation              äººç‰©ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—
  --no-face-detection            é¡”æ¤œå‡ºã‚’ã‚¹ã‚­ãƒƒãƒ—
  --no-shadow                    å½±åŠ¹æœã‚’ç„¡åŠ¹åŒ–
  --zip / --no-zip               ZIP ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ [default: --zip]
  --help                         ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
```

### é«˜åº¦ãªä½¿ç”¨ä¾‹

```bash
# é¡”æ¤œå‡ºãªã—ã€ã‚·ãƒ£ãƒ‰ã‚¦ãªã—
python -m line_stamp_maker process \
  --no-face-detection \
  --no-shadow \
  --output out

# ã‚«ã‚¹ã‚¿ãƒ ã‚µã‚¤ã‚ºã€å¤§ãã„ãƒ†ã‚­ã‚¹ãƒˆ
python -m line_stamp_maker process \
  --sticker-width 300 \
  --sticker-height 300 \
  --font-size 32 \
  --border 12

# ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹ï¼ˆèƒŒæ™¯ã‚’ä¿æŒï¼‰
python -m line_stamp_maker process \
  --no-segmentation \
  --output out
```

### æƒ…å ±è¡¨ç¤º

```bash
python -m line_stamp_maker info
```

## ç”»åƒå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

1. **EXIF å›è»¢è£œæ­£**: è‡ªå‹•çš„ã«æ­£ã—ã„å‘ãã«è£œæ­£
2. **é¡”æ¤œå‡ºã¨ ã‚¯ãƒ­ãƒƒãƒ—**: ï¼ˆæœ‰åŠ¹æ™‚ï¼‰é¡”ã‚’æ¤œå‡ºã—ã¦æœ€é©ã«é…ç½®
3. **ä¸­å¤®ã‚¯ãƒ­ãƒƒãƒ—**: é¡”ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ç”»åƒä¸­å¤®ã‚’ä½¿ç”¨
4. **äººç‰©ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**: MediaPipe ã§èƒŒæ™¯ã‚’é€æ˜åŒ–
5. **æœ€å¤§æˆåˆ†æŠ½å‡º**: æœ€ã‚‚å¤§ãã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã‚’ä¿æŒ
6. **ãƒã‚¹ã‚¯æ•´å½¢**: ãƒ¢ãƒ«ãƒ•ã‚©ãƒ­ã‚¸æ¼”ç®—ã¨ã¼ã‹ã—ã§è‡ªç„¶ãªã‚¨ãƒƒã‚¸
7. **ç™½ãµã¡å–ã‚Š**: æŒ‡å®šãƒ”ã‚¯ã‚»ãƒ«ã®ç™½ã„æ ã‚’è¿½åŠ 
8. **å½±ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ**: è»½ã„å½±ã‚’è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
9. **ãƒ†ã‚­ã‚¹ãƒˆæç”»**: ä¸‹éƒ¨ã«å¸¯å›²ã„ã¨ç¸å–ã‚Šæ–‡å­—ã§ç„¼ãè¾¼ã¿
10. **ã‚µã‚¤ã‚ºå¤‰æ›**: Sticker / Main / Tab ç”¨ã«æœ€é©åŒ–

## ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

### å¿…é ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ç”¨é€” |
|-----------|------|
| `pillow` | ç”»åƒå‡¦ç†ï¼ˆåŸºæœ¬ï¼‰ |
| `mediapipe` | äººç‰©ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ |
| `numpy` | æ•°å€¤è¨ˆç®— |
| `opencv-python` | é«˜åº¦ãªç”»åƒå‡¦ç†ã€é€£çµæˆåˆ†æŠ½å‡º |
| `typer` | CLI ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| `pydantic` | è¨­å®šç®¡ç†ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
| `python-dotenv` | ç’°å¢ƒå¤‰æ•°ç®¡ç† |

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¾å­˜

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ç”¨é€” |
|-----------|------|
| `pillow-heif` | HEIC/HEIF å½¢å¼ã‚µãƒãƒ¼ãƒˆï¼ˆiPhone ãªã©ï¼‰ |

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•:**
```bash
# ã‚ªãƒ–ã‚·ãƒ§ãƒ³ä¾å­˜ã‚’å«ã‚ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -e ".[heic]"

# ã¾ãŸã¯æ‰‹å‹•ã§
pip install pillow-heif>=0.16.0
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### HEIC/HEIF å½¢å¼ãŒé–‹ã‘ãªã„

```
RuntimeError: HEIC/HEIF support requires pillow-heif
```

â†’ HEIC/HEIF ã‚µãƒãƒ¼ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š

```bash
pip install pillow-heif
```

ã¾ãŸã¯ pyproject.toml ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ï¼š

```bash
pip install -e ".[heic]"
```

### MediaPipe ã®ã‚¨ãƒ©ãƒ¼

```
ERROR: Could not load the fast pairwise face detection TFLite model
```

â†’ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒŸã‚¹ãƒãƒƒãƒã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

```bash
pip install --upgrade mediapipe
```

### é¡”ãŒæ¤œå‡ºã•ã‚Œãªã„

- `--no-face-detection` ã§ä¸­å¤®ã‚¯ãƒ­ãƒƒãƒ—ã«åˆ‡ã‚Šæ›¿ãˆ
- èƒŒæ™¯ãŒè¤‡é›‘ãªå ´åˆã€`--no-segmentation` ã‚’è©¦ã™

### ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„

- ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ³ãƒˆã‚’ä½¿ç”¨
- ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’èª¿æ•´ã—ã¦ã¿ã¦ãã ã•ã„ï¼š`--font-size 20`

### ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼

- å…¥åŠ›ç”»åƒã®è§£åƒåº¦ã‚’ä¸‹ã’ã‚‹
- ãƒãƒƒãƒå‡¦ç†ã®æ•°ã‚’æ¸›ã‚‰ã™

## å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

### æˆåŠŸæ™‚ã®å‡ºåŠ›

```
out/
â”œâ”€â”€ stickers/
â”‚   â”œâ”€â”€ 01.png          # ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ç”»åƒï¼ˆæœ€å¤§ 370x320ï¼‰
â”‚   â”œâ”€â”€ 02.png
â”‚   â””â”€â”€ ...
â”œâ”€â”€ main_01.png         # ã‚¹ãƒˆã‚¢è¡¨ç¤ºç”¨ (240x240)
â”œâ”€â”€ main_02.png
â”œâ”€â”€ tab_01.png          # ã‚¿ãƒ–ã‚¢ã‚¤ã‚³ãƒ³ (96x74)
â”œâ”€â”€ tab_02.png
â”œâ”€â”€ upload.zip          # LINE Creators Market ç”¨
â””â”€â”€ results.json        # å‡¦ç†çµæœã‚µãƒãƒªãƒ¼
```

### results.json ã®ä¾‹

```json
{
  "photo1.jpg": {
    "status": "success",
    "sticker": "out/stickers/01.png",
    "main": "out/main_01.png",
    "tab": "out/tab_01.png"
  },
  "photo2.jpg": {
    "status": "success",
    "sticker": "out/stickers/02.png",
    "main": "out/main_02.png",
    "tab": "out/tab_02.png"
  }
}
```

## LINE Creators Market ã¸ã®æå‡º

ä½œæˆã—ãŸ `upload.zip` ã¯ä»¥ä¸‹ã®æ§‹é€ ã‚’æŒã¡ã¾ã™ï¼š

```
upload.zip
â”œâ”€â”€ stickers/
â”‚   â”œâ”€â”€ 01.png
â”‚   â”œâ”€â”€ 02.png
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ 40.png        # MAX 40 stickers
â”œâ”€â”€ main.png          # 240x240
â””â”€â”€ tab.png           # 96x74
```

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ LINE Creators Market ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚

## ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†

ğŸ”’ **é‡è¦**: ã“ã®ãƒ„ãƒ¼ãƒ«ã¯å®Œå…¨ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œã—ã¾ã™ã€‚

- å¤–éƒ¨ API ã‚’ä½¿ç”¨ã—ã¾ã›ã‚“
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã¯ä¸è¦ã§ã™
- ç”»åƒãƒ‡ãƒ¼ã‚¿ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§å‡¦ç†ã•ã‚Œã¾ã™
- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ã•ã‚Œã¦ã„ã¾ã™

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ä½œæˆè€…

LINE Stamp Maker Contributors

## å‚è€ƒè³‡æ–™

- [LINE Creators Market](https://creators.line.me/)
- [MediaPipe Selfie Segmentation](https://google.github.io/mediapipe/solutions/selfie_segmentation.html)
- [Pillow Documentation](https://pillow.readthedocs.io/)
- [OpenCV Documentation](https://docs.opencv.org/)

---

**æ³¨**: ã“ã®ãƒ„ãƒ¼ãƒ«ã¯å€‹äººä½¿ç”¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚å•†ç”¨åˆ©ç”¨ã®éš›ã¯ LINE ã®åˆ©ç”¨è¦ç´„ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
